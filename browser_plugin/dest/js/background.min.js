"use strict";window.browser=function(){return window.msBrowser||window.browser||window.chrome}(),!function(){function a(b,d){return c?void(c.transaction("s").objectStore("s").get(b).onsuccess=function(a){var b=a.target.result&&a.target.result.v||null;d(b)}):void setTimeout(function(){a(b,d)},100)}var b=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;if(!b)return void console.error("indexDB not supported");var c,d={k:"",v:""},e=b.open("d2",1);e.onsuccess=function(){c=this.result},e.onerror=function(a){console.error("indexedDB request error"),console.log(a)},e.onupgradeneeded=function(a){c=null;var b=a.target.result.createObjectStore("s",{keyPath:"k"});b.transaction.oncomplete=function(a){c=a.target.db}},window.ldb={get:a,set:function(a,b){d.k=a,d.v=b,c.transaction("s","readwrite").objectStore("s").put(d)}}}();function checkFakeShop(a,b){if(b){var c="img/action/action-disabled.png",d=localStorage.getItem("disabled_time");if((null==d||d<Date.now()-900000)&&!b.startsWith("chrome://")&&!b.startsWith("about://")){b=new URL(b);var e=window.localStorage.getItem("client_id");null==e&&(e=Math.random().toString(36).substr(2,9),window.localStorage.setItem("client_id",e));var f={method:"POST",body:JSON.stringify({site_baseURL:b,clientID:e}),headers:{"Content-Type":"application/json"},auth_clinetId:"1"};b=b.hostname,b=b.replace("www.","");var g=window.localStorage.getItem("date"),h=!1;if(null==g||86400000<Date.now()-g)fetch("https://mal2.ait.ac.at/fake-shop-detector/api/1.1/whitelist?all=true").then(function(a){return a.json()}).then(function(a){window.ldb.set("whitelist",JSON.stringify(a));for(var d=a,e=0;e<d.length;e++)!1===h&&d[e].site_baseURL===b&&(c="img/action/action-successful.png",h=!0,window.browser.browserAction.setIcon({path:{32:c}}))}).then(fetch("https://mal2.ait.ac.at/fake-shop-detector/api/1.1/blacklist?all=true").then(function(a){return a.json()}).then(function(d){window.ldb.set("blacklist",JSON.stringify(d));var e=d;if(!1===h)for(var f=0;f<e.length&&!1===h;f++)!1===h&&e[f].site_baseURL===b&&(c="img/action/action-disabled.png",window.browser.tabs.sendMessage(a.id,{command:"show_fraud_warning"}),h=!0,window.browser.browserAction.setIcon({path:{32:c}}))})).then(function(){fetch("https://mal2.ait.ac.at/fake-shop-detector/api/1.1/ignorelist?all=true").then(function(a){return a.json()}).then(function(a){window.ldb.set("ignorelist",JSON.stringify(a));var d=a;if(!1===h)for(var e=0;e<d.length;e++)!1===h&&d[e].site_baseURL===b&&(c="img/action/action-ingorelist.png",h=!0,window.browser.browserAction.setIcon({path:{32:c}}))})}).then(function(){!1===h&&fetch("https://mal2.ait.ac.at/fake-shop-detector/api/1.1/analyze",f).then(function(a){return a.json()}).then(function(b){400===b.status&&(c="img/action/action-not-analyzed.png"),"whitelist"===b.processor?c="img/action/action-successful.png":"blacklist"===b.processor?(c="img/action/action-fraud.png",window.browser.tabs.sendMessage(a.id,{command:"show_fraud_warning"})):"mal2_ai"===b.processor&&("very low"===b.risk_score&&"mal2_ai"===b.processor?c="img/action/action-successful.png":"low"===b.risk_score&&"mal2_ai"===b.processor?c="img/action/action-low.png":"below average"===b.risk_score&&"mal2_ai"===b.processor?c="img/action/above-avg.png":"above average"===b.risk_score&&"mal2_ai"===b.processor?c="img/action/action-medium.png":"high"===b.risk_score&&"mal2_ai"===b.processor?c="img/action/action-maybe-fraud.png":"very high"===b.risk_score&&"mal2_ai"===b.processor&&(c="img/action/fraud.png",window.browser.tabs.sendMessage(a.id,{command:"show_potential_fraud_warning"})))}),window.browser.browserAction.setIcon({path:{32:c}}),window.localStorage.setItem("date",Date.now())});else{var k=!1;window.ldb.get("blacklist",function(d){for(var e=JSON.parse(d),g=0;g<e.length&&!1===k;g++)!1===k&&e[g].site_baseURL===b&&(c="img/action/action-fraud.png",window.browser.tabs.sendMessage(a.id,{command:"show_fraud_warning"}),k=!0,window.browser.browserAction.setIcon({path:{32:c}}));window.ldb.get("whitelist",function(d){for(var e=JSON.parse(d),g=0;g<e.length&&!1===k;g++)!1===k&&e[g].site_baseURL===b&&(c="img/action/action-successful.png",k=!0,window.browser.browserAction.setIcon({path:{32:c}}));window.ldb.get("ignorelist",function(d){for(var e=JSON.parse(d),g=0;g<e.length&&!1===k;g++)!1===k&&e[g].site_baseURL===b&&(c="img/action/action-ingorelist.png",k=!0,window.browser.browserAction.setIcon({path:{32:c}}));!1===k&&fetch("https://mal2.ait.ac.at/fake-shop-detector/api/1.1/analyze",f).then(function(a){return a.json()}).then(function(b){400===b.status&&(c="img/action/action-not-analyzed.png"),"whitelist"===b.processor?c="img/action/action-successful.png":"blacklist"===b.processor?(c="img/action/action-fraud.png",window.browser.tabs.sendMessage(a.id,{command:"show_fraud_warning"})):"mal2_ai"===b.processor&&("very low"===b.risk_score&&"mal2_ai"===b.processor?c="img/action/action-successful.png":"low"===b.risk_score&&"mal2_ai"===b.processor?c="img/action/action-medium.png":"below average"===b.risk_score&&"mal2_ai"===b.processor?c="img/action/action-above-avg.png":"above average"===b.risk_score&&"mal2_ai"===b.processor?c="img/action/action-medium.png":"high"===b.risk_score&&"mal2_ai"===b.processor?c="img/action/action-medium.png":"very high"===b.risk_score&&"mal2_ai"===b.processor&&(c="img/action/action-fraud.png",window.browser.tabs.sendMessage(a.id,{command:"show_potential_fraud_warning"}))),window.browser.browserAction.setIcon({path:{32:c}})})})})}),window.browser.browserAction.setIcon({path:{32:c}})}}null==d?(c="img/action/action-disabled.png",window.browser.browserAction.setIcon({path:{32:c}})):(c="img/action/action-not-analyzed.png",window.browser.browserAction.setIcon({path:{32:c}}))}}window.browser.tabs.onActivated.addListener(function(){window.browser.tabs.getSelected(null,function(a){checkFakeShop(a,a.url)})}),window.browser.tabs.onUpdated.addListener(function(a,b,c){checkFakeShop(c,c.url)}),window.browser.runtime.onMessage.addListener(function(){window.browser.tabs.getSelected(null,function(a){checkFakeShop(a,a.url)})}),window.browser.runtime.onInstalled.addListener(function(){window.browser.tabs.create({url:window.browser.extension.getURL("options/options.html")},function(){})});
//# sourceMappingURL=background.min.js.map
